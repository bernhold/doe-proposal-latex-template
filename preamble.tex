%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Setup packages, style, additional commands, etc.
% $Id$
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\zapspace}[0]{}
\usepackage[letterpaper,margin=1in]{geometry}

\usepackage[utf8]{inputenc}     % Better for text pasted from Word & such
\usepackage[T1]{fontenc}
\usepackage{bigstrut}           % Used by Excel2LATeX exports
\usepackage{amsmath}            % Used by OpenOffice LaTeX exporter
% packages above (probably amsmath) need to preceed fxfonts
\usepackage{txfonts}            % Use native postscript fonts

\usepackage{cite}

% For some math symbols
\usepackage{wasysym}
\usepackage{hhline}  % horizontal lines
\usepackage{subfig} % for subfigures

\usepackage{varioref}

\usepackage{url}
\usepackage{xcolor}
\usepackage{colortbl}
\usepackage{listings}
%%\usepackage[bookmarks=false,pdfpagelayout=SinglePage]{hyperref}
\usepackage[bookmarksopen=true,bookmarksopenlevel=0,pdfpagelayout=SinglePage]{hyperref}

\usepackage{longtable}
% Default caption width for longtable environments
\setlength{\LTcapwidth}{\textwidth}
\usepackage{multirow}
\usepackage[font=it,labelfont=bf]{caption}
\usepackage{sidecap}            % Alternative to constructing minipages
\usepackage{tabularx}
\usepackage{ragged2e}
\usepackage{rotating}

\usepackage{fancyhdr}
\usepackage{graphicx} 
\usepackage{caption}
\usepackage{wrapfig}
\usepackage{pdfpages}
\usepackage[compact]{titlesec}
%%% \usepackage[iso]{datetime}
%%% \settimeformat{ampmtime}        % Override iso time format
%%%\usepackage{xcomment}
%%%\usepackage{paralist}           % Provides compact versions of lists
\usepackage{enumitem}
\usepackage{ifthen}
\usepackage{rotating}
\usepackage{listings}
\usepackage{calc}                  % Used in participant table construction

\usepackage{csvsimple-l3}     %% Used to process some configuration info
\usepackage{etoolbox}         %% help with some csv processing
\usepackage[acronym,nohypertypes=acronym]{glossaries}
\usepackage{appendix}
\usepackage[chapter,numbib]{tocbibind}
\usepackage{etoc}             %% To get easy local table of contents
\usepackage{todonotes}        %% Add [disable] option to quickly get rid of all notes
\usepackage{lipsum}           %% Used for placeholder text
\usepackage[symbol*]{footmisc} %% Use symbols for footnotes to help distinguish from citations

%%%%% Packages to avoid, and alternatives
% epsfig: already using graphicx
% here: use [!ht] or float.sty [H] instead
% times: txfonts

% remove red border around links (comment out if you want the border)
%\hypersetup{pdfborder={0 0 0}}
\hypersetup{colorlinks=true,citecolor=blue,linkcolor=blue,urlcolor=blue,pdfborder={0 0 0}}

%%%%% Todo notes %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setuptodonotes{inline}

%%%%% Headers and footers %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pagestyle{fancy}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}}
\fancyhead{}
\fancyhead[R]{\emph{\rightmark}}
\fancyhead[L]{\emph{\leftmark}}
% These changes are suggested in the fancyhdr manual to eliminate complaints
% about the headheight being too small.
\setlength{\headheight}{14.0pt}
\addtolength{\topmargin}{-2.0pt}

%%%%% Table of contents %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\addtocounter{secnumdepth}{1} %%%%% Number subsubsections
\addtocounter{tocdepth}{1}    %%%%% Display subsubsections in TOC

%%%%% Section headings %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Uses titlesec package

\titleformat{\chapter}[hang]
   {\normalfont\Huge\bfseries}{\thechapter.}{10pt}{\Huge}

\titlespacing*{\chapter}{0pt}{0pt}{1ex} %%% * kill first para indentation

% Saves about 20 lines in current proposal
%\titlespacing*{\paragraph} {0pt}{0ex plus 1ex minus .2ex}{1em}

%% % Default spacings, for reference
%% \titlespacing*{\chapter} {0pt}{50pt}{40pt}
%% \titlespacing*{\section} {0pt}{3.5ex plus 1ex minus .2ex}{2.3ex plus .2ex}
%% \titlespacing*{\subsection} {0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}
%% \titlespacing*{\subsubsection}{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}
%% \titlespacing*{\paragraph} {0pt}{3.25ex plus 1ex minus .2ex}{1em}
%% \titlespacing*{\subparagraph} {\parindent}{3.25ex plus 1ex minus .2ex}{1em}

%%%%% Spacing %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Best to change from defaults only at the very end, to refine space.

%% \setlength{\textfloatsep}{0pt}         %%% 20pt
%% \setlength{\floatsep}{0pt}             %%% 12pt
%% \setlength{\intextsep}{0pt}            %%% 12pt

%% \setlength{\dblfloatsep}{6pt}          %%% 12pt
%% \setlength{\abovecaptionskip}{2pt}     %%% 10pt
%% \setlength{\belowcaptionskip}{2pt}     %%% ??

%% Parameters influencing how LaTeX places floats

%% % General parameters for all pages:
%% \renewcommand\topfraction{.7}          %%% Default: 0.7
%% \renewcommand\bottomfraction{.3}       %%% Default: 0.3

%% % Parameters for TEXT (not float) pages
%% \setcounter{topnumber}{2}              %%% Default: 2
%% \setcounter{bottomnumber}{1}           %%% Default: 1
%% \setcounter{totalnumber}{3}            %%% Default: 3
%% \setcounter{dbltopnumber}{2}           %%% Default: 2
%% \renewcommand\textfraction{.2}         %%% Default: 0.2
%% \renewcommand\dbltopfraction{.7}       %%% Default: 0.7

%% % Parameters for FLOAT (not text) pages
%% \renewcommand\floatpagefraction{.5}    %%% Default: 0.5
%% \renewcommand\dblfloatpagefraction{.5} %%% Default: 0.5

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Set default style for code displays in the listings package
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%\lstset{basicstyle=\ttfamily}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Specialized lists using the enumitem package
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% A list for the milestone table that removes as much vertical and
% horizontal space as possible.
\newlist{milestones}{itemize}{1}
\setlist[milestones]{label=\textbullet,nosep,leftmargin=*,
  before=\vspace{-12pt},after=\vspace{-12pt}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Specialized sectioning commands for bios, other-support, facilities, sows
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Arguments should be of the form {Oak Ridge National Laboratory}{ornl}
\newcommand{\facilitiessection}[2]{
  \section*{#1}
  \markright{#1}
  \phantomsection % Needed by hyperref because of the unnumbered section
  \addcontentsline{toc}{section}{\numberline {}#1}
  \label{sec:facilities-#2}
}

% Arguments should be of the form {Oak Ridge National Laboratory}{ornl}
\newcommand{\sowsection}[2]{
  \section*{#1 Statement of Work}
  \markright{#1}
  \phantomsection % Needed by hyperref because of the unnumbered section
  \addcontentsline{toc}{section}{\numberline {}#1}
  \label{sec:sow-#2}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Redefine the tableofcontents to not uppercase the heading marks
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \makeatletter
% \renewcommand\tableofcontents{%
%     \if@twocolumn
%       \@restonecoltrue\onecolumn
%     \else
%       \@restonecolfalse
%     \fi
%     \chapter*{\contentsname
%         \@mkboth{\contentsname}{}}%
%     \@starttoc{toc}%
%     \if@restonecol\twocolumn\fi
%     }
% \makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Smart inclusion of non-technical inputs (TEX preferred, otherwise PDF)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Shorthand for providing and initially setting
\newcommand{\provBoolDflt}[2]{
   \provideboolean{#1}
   \setboolean{#1}{#2}
}
% smartincludes should warn when expected files are not found
\provBoolDflt{printmissingwarnings}{true}
% missing smartincludes should appear in table of contents
\provBoolDflt{printmissingintoc}{true}

\newcommand{\smartinclude}[2]{
   \IfFileExists{#2.tex}{
      % Assume tex file contains any heading/TOC adjustments
      \input{#2}
   }{
      \IfFileExists{#2.pdf}{

        % Set headers and TOC entry
        \markright{#1}
        \phantomsection % Needed by hyperref because of the unnumbered section
        \addcontentsline{toc}{section}{\numberline {}#1}

         % Use fancy page style to put headers and page numbers on the
         % included pages for easier navigation.  With luck, the included
         % pages will not overlap these marks.
         \includepdf[pages=-,pagecommand={\thispagestyle{fancy}}]{#2}
      }{
         % If the desired PDF file doesn't exist, warn about it but continue

         % May not want to include missing files in table of contents
         \ifthenelse{\boolean{printmissingintoc}}{
           % Set headers and TOC entry
           \markright{#1}
           \phantomsection % Needed by hyperref because of the unnumbered section
           \addcontentsline{toc}{section}{\numberline {}#1}
         }{}

         \ifthenelse{\boolean{printmissingwarnings}}{
           \begin{center} 
              \textbf{\color{red}\Large No file found for '#1'!\\
                      Tried #2.tex and #2.pdf} \\
           \end{center}
           \typeout{smartinclude: WARNING: File not found: #2.tex or #2.pdf}
         }{}
      }     
   }
}

% empty page style version
\newcommand{\smartincludeempty}[2]{
   \IfFileExists{#2.tex}{
      % Assume tex file contains any heading/TOC adjustments
      \input{#2}
   }{
      \IfFileExists{#2.pdf}{

        \newpage
        % Set headers and TOC entry
        \markright{#1}
        \phantomsection % Needed by hyperref because of the unnumbered section
        \addcontentsline{toc}{section}{\numberline {}#1}

         % Use fancy page style to put headers and page numbers on the
         % included pages for easier navigation.  With luck, the included
         % pages will not overlap these marks.
         \includepdf[pages=-,pagecommand={\thispagestyle{empty}}]{#2}
      }{
         % If the desired PDF file doesn't exist, warn about it but continue

         % May not want to include missing files in table of contents
         \ifthenelse{\boolean{printmissingintoc}}{
           \newpage
           % Set headers and TOC entry
           \markright{#1}
           \phantomsection % Needed by hyperref because of the unnumbered section
           \addcontentsline{toc}{section}{\numberline {}#1}
         }{}

         \ifthenelse{\boolean{printmissingwarnings}}{
           \begin{center}
              \textbf{\color{red}\Large No file found for '#1'!\\
                      Tried #2.tex and #2.pdf} \\
           \end{center}
           \typeout{smartinclude: WARNING: File not found: #2.tex or #2.pdf}
         }{}
      }     
   }
}

% plain page style version
\newcommand{\smartincludeplain}[2]{
   \IfFileExists{#2.tex}{
      % Assume tex file contains any heading/TOC adjustments
      \input{#2}
   }{
      \IfFileExists{#2.pdf}{

        \newpage
        % Set headers and TOC entry
        \markright{#1}
        \phantomsection % Needed by hyperref because of the unnumbered section
        \addcontentsline{toc}{section}{\numberline {}#1}

         % Use fancy page style to put headers and page numbers on the
         % included pages for easier navigation.  With luck, the included
         % pages will not overlap these marks.
         \includepdf[pages=-,pagecommand={\thispagestyle{plain}}]{#2}
      }{
         % If the desired PDF file doesn't exist, warn about it but continue

         % May not want to include missing files in table of contents
         \ifthenelse{\boolean{printmissingintoc}}{
           \newpage
           % Set headers and TOC entry
           \markright{#1}
           \phantomsection % Needed by hyperref because of the unnumbered section
           \addcontentsline{toc}{section}{\numberline {}#1}
         }{}

         \ifthenelse{\boolean{printmissingwarnings}}{
           \begin{center}
              \textbf{\color{red}\Large No file found for '#1'!\\
                      Tried #2.tex and #2.pdf} \\
           \end{center}
           \typeout{smartinclude: WARNING: File not found: #2.tex or #2.pdf}
         }{}
      }     
   }
}

% empty page style CHAPTER version
\newcommand{\smartincludeemptych}[2]{
   \IfFileExists{#2.tex}{
      % Assume tex file contains any heading/TOC adjustments
      \input{#2}
   }{
      \IfFileExists{#2.pdf}{

        \newpage
        % Set headers and TOC entry
        \markboth{#1}{}
        \phantomsection % Needed by hyperref because of the unnumbered section
        %%      \addcontentsline{toc}{chapter}{#1}
        %% \addstarredchapter{#1}
        %%      \adjustmtc

         % Use fancy page style to put headers and page numbers on the
         % included pages for easier navigation.  With luck, the included
         % pages will not overlap these marks.
         \includepdf[pages=-,pagecommand={\thispagestyle{empty}}]{#2}
      }{
         % If the desired PDF file doesn't exist, warn about it but continue

         % May not want to include missing files in table of contents
         \ifthenelse{\boolean{printmissingintoc}}{
           \newpage
           % Set headers and TOC entry
           \markboth{#1}{}
           \phantomsection % Needed by hyperref because of the unnumbered section
           %%      \addcontentsline{toc}{chapter}{#1}
           %% \addstarredchapter{#1}
           %%      \adjustmtc
         }{}

         \ifthenelse{\boolean{printmissingwarnings}}{
           \begin{center}
              \textbf{\color{red}\Large No file found for '#1'!\\
                      Tried #2.tex and #2.pdf} \\
           \end{center}
           \typeout{smartinclude: WARNING: File not found: #2.tex or #2.pdf}
         }{}
      }     
   }
}

% plain page style CHAPTER version
\newcommand{\smartincludeplainch}[2]{
   \IfFileExists{#2.tex}{
      % Assume tex file contains any heading/TOC adjustments
      \input{#2}
   }{
      \IfFileExists{#2.pdf}{

        \newpage
        % Set headers and TOC entry
        \markboth{#1}{}
        \phantomsection % Needed by hyperref because of the unnumbered section
        %%      \addcontentsline{toc}{chapter}{#1}
        %% \addstarredchapter{#1}
        %%      \adjustmtc

         % Use fancy page style to put headers and page numbers on the
         % included pages for easier navigation.  With luck, the included
         % pages will not overlap these marks.
         \includepdf[pages=-,pagecommand={\thispagestyle{plain}}]{#2}
      }{
         % If the desired PDF file doesn't exist, warn about it but continue

         % May not want to include missing files in table of contents
         \ifthenelse{\boolean{printmissingintoc}}{
           \newpage
           % Set headers and TOC entry
           \markboth{#1}{}
           \phantomsection % Needed by hyperref because of the unnumbered section
           %%      \addcontentsline{toc}{chapter}{#1}
           %% \addstarredchapter{#1}
           %%      \adjustmtc
         }{}

         \ifthenelse{\boolean{printmissingwarnings}}{
           \begin{center}
              \textbf{\color{red}\Large No file found for '#1'!\\
                      Tried #2.tex and #2.pdf} \\
           \end{center}
           \typeout{smartinclude: WARNING: File not found: #2.tex or #2.pdf}
         }{}
      }     
   }
}
