#!/bin/sh
# Usage: config-personnel
# Input and output filename are currently fixed
#    input: personnel.config
#    outputs: cvs.tex
#             bios.tex
#             other-support.tex
#             acronym-pis.tex

configfile="personnel.config"
biosfile="bios.tex"
cvsfile="cvs.tex"
supportfile="other-support.tex"
acrofile="acronym-pis.tex"

###############################################################################
# Bios
###############################################################################

echo "% Generated by $0 on `date`" > $biosfile

cat <<EOF >> $biosfile

\chapter{Biographical Sketches}
\label{sec:bios}

\noindent
Biographical sketches of the senior personnel follow in alphabetical
order.  

\minitoc

\newpage

EOF

grep -v "^\#" $configfile | \
   awk -F\| '{printf "\\smartinclude{%s %s --- \\%s}{bios/%s}\n\\newpage\n", \
   $2, $1, $3, tolower(gensub(/\W/, "", "g", $1))}' >> $biosfile

###############################################################################
# Other Support
###############################################################################

echo "% Generated by $0 on `date`" > $supportfile

cat <<EOF >> $supportfile

\chapter{Other Support of Investigators}
\label{sec:other-support}

\noindent
Other support of the investigators follow in alphabetical
order.  

\minitoc

\newpage

EOF

grep -v "^\#" $configfile | \
   awk -F\| '{printf "\\smartinclude{%s %s --- \\%s}{other-support/%s}\n\\newpage\n", \
   $2, $1, $3, tolower(gensub(/\W/, "", "g", $1))}' >> $supportfile

###############################################################################
# Acronym definitions for Institutional PIs
###############################################################################

echo "% Generated by $0 on `date`" > $acrofile

grep -v "^\#" $configfile | \
   awk -F\| \
     '$4 ~ /(lpi)|(cpi)/ {printf "\\newcommand{\\%spi}{%s %s}\n", $3, $2, $1}' \
   >> $acrofile
