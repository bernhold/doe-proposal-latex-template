#!/bin/sh
# Usage: config-institutions <lead institution>
# Input and output filename are currently fixed
#    input: institutions.config
#    outputs: acronym-inst.tex
#             budgets.tex
#	      facilities.tex
#	      sows.tex

lead="$1"

configfile="institutions.config"
acrofile="acronym-inst.tex"
budgetfile="budgets.tex"
facilitiesfile="facilities.tex"
sowsfile="sows.tex"

###############################################################################
# Acronyms
###############################################################################

echo "% Generated by $0 on `date`" > $acrofile
echo "% lowercase commands give abbreviations, uppercase give full name" \
     >> $acrofile
echo >> $acrofile	# Blank line for readability

grep -v "^\#" $configfile | \
   awk -F\| '{printf "\\newcommand{\\%s}{%s}\n", $1, $2}' \
   >> $acrofile

echo >> $acrofile	# Blank line for readability

grep -v "^\#" $configfile | \
   awk -F\| '{printf "\\newcommand{\\%s}{%s}\n", toupper($1), $3}' \
   >> $acrofile

###############################################################################
# Budgets
###############################################################################

# echo "% Generated by $0 on `date`" > $budgetfile

# cat <<EOF >> $budgetfile

# % Lead institution includes summary and all budgets.  
# % Others include only their own.

# \ifthenelse{\boolean{includeleadcontent}}{
#   \phantomsection
#   \addcontentsline{toc}{chapter}{Budget}
#   \label{sec:budget}

#   \input{summary-budget}

#   \newpage
# EOF

# # First, find lead institution based on command line argument

# grep -v "^\#" $configfile | grep ^$lead | \
#    awk -F\| '{printf "\\smartinclude{\\protect\\acl*{%s}}{budgets/%s}\n\\label{budget:%s}\\label{budgets:mine}\n\\newpage\n", $1, $1, $1}' \
#    >> $budgetfile

# echo >> $budgetfile		# Blank line for readability

# # Then do everyone else

# grep -v "^\#" $configfile | grep -v ^$lead | \
#    awk -F\| '$4 == "f" {printf "\\smartinclude{\\protect\\acl*{%s}}{budgets/%s}\n\\label{budget:%s}\n\\newpage\n", $1, $1, $1}' \
#    >> $budgetfile


# cat <<EOF >> $budgetfile
# }{
# % Non-leads include their own budget only
#   \smartincludeemptych{Budget}{budgets/\proposalinstitution}
#   \label{budget:mine} \label{budget:\proposalinstitution}
# }
# EOF

###############################################################################
# Facilities
###############################################################################

echo "% Generated by $0 on `date`" > $facilitiesfile

cat <<EOF >> $facilitiesfile

\chapter{Description of Facilities and Resources}
\label{sec:facilities}

\noindent
Descriptions of institutional facilities and resources follow in
alphabetical order.

\minitoc

EOF

grep -v "^\#" $configfile | \
   awk -F\| '{printf "\\newpage\n\\smartinclude{\\%s}{facilities/%s}\n", toupper($1), $1}' \
   >> $facilitiesfile

###############################################################################
# SOWS
###############################################################################

# echo "% Generated by $0 on `date`" > $sowsfile

# cat <<EOF >> $sowsfile

# \chapter{Statements of Work}
# \label{sec:sows}

# \noindent Institutional statements of work follow in alphabetical
# order.

# \minitoc

# \newpage

# EOF

# grep -v "^\#" $configfile | \
#    awk -F\| '{printf "\\newpage\n\\smartinclude{\\protect\\acl*{%s}}{sows/%s}\n", $1, $1}' \
#    >> $sowsfile

